From: NeuVector Scanner Patch
Subject: [PATCH] fix: remove jar: shortcut key that causes false positive CVE matches

The LoadAppVulsTb() function generates a jar:<artifactId> shortcut lookup
key for every CVE entry with a colon-separated module name. For example,
com.squareup.okhttp3:okhttp produces a shortcut key jar:okhttp.

When JARs without pom.properties are scanned (e.g., OpenTelemetry JARs),
their MANIFEST.MF fallback produces generic module names like jar:okhttp,
jar:library, jar:metrics, jar:common. These collide with the shortcut keys
from unrelated CVE entries, causing widespread false positive matches.

Documented impact: 28 false positive CVE findings across 23 OpenTelemetry
JARs in a single Spring Boot application image, matching against Jenkins
FindBugs Plugin, Jenkins Metrics Plugin, and OkHttp CVEs.

This patch removes the jar: shortcut key generation while preserving the
original groupId:artifactId keys and dot-separated backward-compat keys.

Safety:
- JARs with pom.properties: unaffected (match via groupId:artifactId)
- JARs with proper MANIFEST.MF vendor: unaffected (match via vendorId:title)
- log4j: unaffected (has dedicated handling in DetectAppVul)
- JARs with vendor=jar fallback: no longer match, which is correct behavior

---
 common/db.go            | 13 ++++---------
 common/db_test.go       | 60 +++++++++++++++++++++++++++++++++++++++++++++++++
 cvetools/apps_test.go   | 85 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 149 insertions(+), 9 deletions(-)

diff --git a/common/db.go b/common/db.go
--- a/common/db.go
+++ b/common/db.go
@@ -XXX,XX +XXX,XX @@ func LoadAppVulsTb(path string) (map[string][]AppModuleVul, error) {

 	// for org.apache.logging.log4j:log4j-core, we will also search
 	// org.apache.logging.log4j.log4j-core: for backward compatibility
-	// log4j-core: for jar file without pom.xml. Prefix jar: to avoid collision
+	// NOTE: The previous jar:<artifactId> shortcut key was removed because it
+	// caused false positive collisions with unrelated modules (e.g., jar:okhttp
+	// from OpenTelemetry matched against com.squareup.okhttp3:okhttp CVEs).
 	var mns []string
 	for mn := range vul {
 		if colon := strings.LastIndex(mn, ":"); colon > 0 {
@@ -XXX,XX +XXX,XX @@ func LoadAppVulsTb(path string) (map[string][]AppModuleVul, error) {
 	}

 	for _, mn := range mns {
-		colon := strings.LastIndex(mn, ":")
 		m := strings.ReplaceAll(mn, ":", ".")
 		vf := vul[mn]

@@ -XXX,XX +XXX,XX @@ func LoadAppVulsTb(path string) (map[string][]AppModuleVul, error) {
 		} else {
 			vul[m] = vf
 		}
-		if m = mn[colon+1:]; len(m) > 0 {
-			key := fmt.Sprintf("jar:%s", m)
-			if _, ok := vul[key]; ok {
-				vul[key] = uniqueVulDb(append(vul[key], vf...))
-			} else {
-				vul[key] = vf
-			}
-		}
 	}
 	return vul, nil
 }
